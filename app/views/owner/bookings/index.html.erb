<h1>Tableau de bord</h1>

<%############# 1-LES ELFES DES AUTRES ############%>

<h2>Les elfes que j'ai réservés</h2>

<%# Les réservations que j'ai demandées,
    dont j'attend la réponse %>

<h3>En attente :</h3>

<% if @bookings.where(status: 'pending').any? %>
  <% @bookings.where(status: 'pending').each do |booking| %>
    <%= booking.elf.name %><br>
    <%= booking.status %><br>
    <%= booking.checkin %><br>
    <%= booking.checkout %><br>
  <% end %>
<% else %>
  <p>Vous n'avez aucune réservation en attente de réponse.</p>
<% end %>

<%# Les réservations que j'ai demandées,
    auxquelles les users ont répondu %>

<h3>Réservations prévues ou en cours :</h3>

<% if @bookings.where(status: 'settled').any? %>
  <% @bookings.where(status: 'settled')
              .or(@bookings.where(status: 'declined'))
              .each do |booking| %>
    <%= booking.elf.name %><br>
    <%= booking.status %><br>
    <%= booking.checkin %><br>
    <%= booking.checkout %><br>
  <% end %>
<% elsif @bookings.where(status: 'declined').any? %>
  <% @bookings.where(status: 'declined')
              .or(@bookings.where(status: 'declined'))
              .each do |booking| %>
    <%= booking.elf.name %><br>
    <%= booking.status %><br>
    <%= booking.checkin %><br>
    <%= booking.checkout %><br>
  <% end %>
<% else %>
  <p>Vous n'avez .</p>
<% end %>

<%############ 2-MES ELFES ############%>

<h2>Les réservations de mes elfes</h2>


<% if @elves.any? %>

  <%# Les réservations d'autres users,
      en attente de MA réponse %>
  <h3>En attente :</h3>

  <% @elves.each do |elf| %>
    <% if elf.bookings.where(status: 'pending') %>
      <% elf.bookings.where(status: 'pending').each do |booking| %>
        <div class="owner-elf-container">
          <div class="owner-elf-card">
            <p><%= booking.elf.name %></p>
            <%= cl_image_tag elf.photo.key %>
            <p>Du: <%= booking.checkin %></p>
            <p>Au: <%= booking.checkout %></p>
            <button class="btn btn-success">Accepter</button>
            <button class="btn btn-danger">Refuser</button>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>Personne n'a demandé à réserver vos elfes pour l'instant.</p>
    <% end %>
  <% end %>

  <%# Les réservations que j'ai déjà acceptées %>
  <h3>Réservations prévues ou en cours :</h3>

  <% @elves.each do |elf| %>
    <% if elf.bookings.where(status: 'settled') %>
      <% elf.bookings.where(status: 'settled').each do |booking| %>
        <div class="owner-elf-container">
          <div class="owner-elf-card">
            <p><%= booking.elf.name %></p>
            <%= cl_image_tag elf.photo.key %>
            <p>Du: <%= booking.checkin %></p>
            <p>Au: <%= booking.checkout %></p>
            <% if booking.status == 'settled' %>
              <button class="btn btn-success">Accepté</button>
            <% else %>
              <button class="btn btn-danger">Refusée</button>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>Aucun de vos elfes n'est réservé pour l'instant.</p>
    <% end %>
  <% end %>

<% else %>
  <p>Je n'ai aucun elfe à proposer !</p>
  <%= link_to 'Ajouter un elfe', new_elf_path %>
<% end %>

<%# ############################ %>
<h2>Tous mes elfes</h2>

<div class="owner-elf-container">
  <% @elves.each do |elf| %>
    <div class="owner-elf-card">
      <%= link_to elf_path(elf), class: "text-decoration-none text-dark" do %>
        <%= cl_image_tag elf.photo.key %>
        <p><%= elf.name %></p>
      <% end %>
    </div>
  <% end %>
    <div class="owner-elf-card">
      <%= link_to new_elf_path, class: "text-decoration-none text-dark" do %>
        <%= image_tag 'avatar.png', class: 'owner-add-elf-img' %>
        <p class="owner-add-elf-p">Nouvel elfe</p>
      <% end %>
    </div>
</div>
